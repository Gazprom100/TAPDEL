# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–ü–û–õ–ù–ï–ù–ò–ô –ò –í–´–í–û–î–û–í DEL

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª:** "–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –≤—ã–≤–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç"

### **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
–ü—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –ª–æ–≥–æ–≤ deployment –≤–∏–¥–Ω–æ:
```
üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º DecimalChain —Å–µ—Ä–≤–∏—Å...
‚ùå Redis –æ—à–∏–±–∫–∞: ERR_SSL_WRONG_VERSION_NUMBER
‚ö†Ô∏è DecimalChain —Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: Timeout: DecimalChain –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 30 —Å–µ–∫—É–Ω–¥
‚ÑπÔ∏è –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –±–µ–∑ DecimalChain —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
```

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** DecimalChain —Å–µ—Ä–≤–∏—Å –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è –∏–∑-–∑–∞ Redis SSL –æ—à–∏–±–æ–∫.

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### **1. Graceful Degradation –¥–ª—è DecimalService**

–°–¥–µ–ª–∞–ª DecimalChain —Å–µ—Ä–≤–∏—Å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º –æ—Ç Redis –¥–ª—è –±–∞–∑–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:

#### **–í `backend/services/decimalService.js`:**
```javascript
async initialize() {
  // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º RPC (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ)
  const blockNumber = await this.web3.eth.getBlockNumber();
  console.log(`‚úÖ DecimalService: –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ DecimalChain RPC, –±–ª–æ–∫: ${blockNumber}`);
  
  // Redis –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω
  try {
    // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis —Å timeout
    await Promise.race([connectPromise, timeoutPromise]);
    this.hasRedis = true;
  } catch (redisError) {
    console.warn('‚ö†Ô∏è DecimalService: Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Ä–∞–±–æ—Ç–∞–µ–º –±–µ–∑ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è');
    this.hasRedis = false;
    this.redis = null;
  }
  
  this.isInitialized = true;
  return true;
}
```

### **2. Nonce –±–µ–∑ Redis**

–ò—Å–ø—Ä–∞–≤–∏–ª –ø–æ–ª—É—á–µ–Ω–∏–µ nonce –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ Redis:

```javascript
async getNonce(address, ttl = 30) {
  if (this.hasRedis && this.redis) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
    try {
      const cached = await this.redis.get(key);
      // ... –ª–æ–≥–∏–∫–∞ —Å –∫–µ—à–µ–º
    } catch (redisError) {
      // Fallback –Ω–∞ –ø—Ä—è–º–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ
      const transactionCount = await this.web3.eth.getTransactionCount(address);
      return Number(transactionCount);
    }
  } else {
    // –ë–µ–∑ Redis - –ø—Ä—è–º–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –±–ª–æ–∫—á–µ–π–Ω–∞
    const transactionCount = await this.web3.eth.getTransactionCount(address);
    return Number(transactionCount);
  }
}
```

### **3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–ª–æ–∫–æ–≤ –±–µ–∑ Redis**

–î–æ–±–∞–≤–∏–ª –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

```javascript
// –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–ª–æ–∫–∞
if (this.hasRedis && this.redis) {
  try {
    lastBlock = await this.redis.get(lastBlockKey);
  } catch (redisError) {
    lastBlock = this.localLastBlock; // Fallback
  }
} else {
  lastBlock = this.localLastBlock; // –ë–µ–∑ Redis
}
```

### **4. –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏**

```javascript
constructor() {
  this.web3 = new Web3(config.RPC_URL);
  this.redis = null;
  this.hasRedis = false;
  this.localLastBlock = null; // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
  this.isInitialized = false;
}
```

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

### **‚úÖ –¢–µ–ø–µ—Ä—å DecimalChain —Å–µ—Ä–≤–∏—Å:**
- ‚úÖ **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è** –¥–∞–∂–µ –±–µ–∑ Redis
- ‚úÖ **–ü–æ–ª—É—á–∞–µ—Ç nonce** –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –±–ª–æ–∫—á–µ–π–Ω–∞
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç –±–ª–æ–∫–∏** —Å –ª–æ–∫–∞–ª—å–Ω—ã–º —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- ‚úÖ **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** —á–µ—Ä–µ–∑ RPC
- ‚úÖ **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–µ–ø–æ–∑–∏—Ç—ã** –∏ –≤—ã–≤–æ–¥—ã

### **üìä –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π –∏ –≤—ã–≤–æ–¥–æ–≤:**

#### **–ü–æ–ø–æ–ª–Ω–µ–Ω–∏—è (–î–µ–ø–æ–∑–∏—Ç—ã):**
1. `POST /api/decimal/deposits` - ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–∞
2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–ª–æ–∫—á–µ–π–Ω–∞ - ‚úÖ –ü–æ–∏—Å–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π  
3. –ê–≤—Ç–æ–∑–∞—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

#### **–í—ã–≤–æ–¥—ã (Withdrawals):**
1. `POST /api/decimal/withdrawals` - ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞
2. –í–æ—Ä–∫–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ - ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
3. –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### **–ü–æ—Å–ª–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ deployment:**
1. **DecimalChain —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è** –±–µ–∑ Redis –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
2. **API —Ä–æ—É—Ç—ã** `/api/decimal/*` –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã
3. **–ü–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –≤—ã–≤–æ–¥—ã** –∑–∞—Ä–∞–±–æ—Ç–∞—é—Ç

### **–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
üîó –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ DecimalChain RPC...
‚úÖ DecimalService: –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ DecimalChain RPC, –±–ª–æ–∫: 12345
‚ö†Ô∏è DecimalService: Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Ä–∞–±–æ—Ç–∞–µ–º –±–µ–∑ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è nonce
‚úÖ DecimalService: –ë–∞–∑–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
üîó DecimalChain API —Ä–æ—É—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã
```

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–∞
curl -X POST https://tapdel.onrender.com/api/decimal/deposits \
  -H "Content-Type: application/json" \
  -d '{"userId": "test", "baseAmount": 1.0}'

# –°–æ–∑–¥–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞  
curl -X POST https://tapdel.onrender.com/api/decimal/withdrawals \
  -H "Content-Type: application/json" \
  -d '{"userId": "test", "toAddress": "0x...", "amount": 0.5}'
```

## ‚ö†Ô∏è –í–ê–ñ–ù–û

### **–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ **DecimalChain –Ω–µ–∑–∞–≤–∏—Å–∏–º –æ—Ç Redis**
- ‚úÖ **Graceful degradation** –ø—Ä–∏ Redis –æ—à–∏–±–∫–∞—Ö  
- ‚úÖ **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** –¥–ª—è nonce –∏ –±–ª–æ–∫–æ–≤
- ‚úÖ **–ü—Ä—è–º–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ nonce** –∏–∑ –±–ª–æ–∫—á–µ–π–Ω–∞

### **–ß—Ç–æ –ù–ï –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- ‚ùå **–õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã**: –ù–µ —Ç—Ä–æ–Ω—É—Ç–∞
- ‚ùå **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚ùå **API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã**: –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

---

**üéâ –ü–û–ü–û–õ–ù–ï–ù–ò–Ø –ò –í–´–í–û–î–´ –ë–£–î–£–¢ –†–ê–ë–û–¢–ê–¢–¨ –ü–û–°–õ–ï –°–õ–ï–î–£–Æ–©–ï–ì–û DEPLOYMENT!** 