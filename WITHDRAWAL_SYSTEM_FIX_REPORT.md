# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –°–ò–°–¢–ï–ú–´ –í–´–í–û–î–û–í

## üìã –ü–†–û–ë–õ–ï–ú–ê

–°–∏—Å—Ç–µ–º–∞ –≤—ã–≤–æ–¥–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –í—ã–≤–æ–¥—ã –∑–∞—Å—Ç—Ä–µ–≤–∞–ª–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ **"processing"**
- **TX Hash –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª** - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å
- **DecimalChain API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω** (404/403 –æ—à–∏–±–∫–∏)
- –¢–æ–ª—å–∫–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–ª–∞

## üîç –î–ò–ê–ì–ù–û–ó

### –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Å—Ç–∞:
1. **Withdrawal Worker** - –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –≤—ã–≤–æ–¥—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—è `processingStartedAt`** - —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–≥–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–∞—Å—Ç—Ä—è–≤—à–∏–µ –≤—ã–≤–æ–¥—ã
3. **API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω** - –Ω–æ fallback –Ω–∞ RPC —Ä–∞–±–æ—Ç–∞–ª
4. **–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å–∞** - –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### –õ–æ–≥–∏ –æ—à–∏–±–æ–∫:
```
Error getting address balance: Error: HTTP 404: Not Found
Error sending transaction: Error: HTTP 403: Forbidden
API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º RPC –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `decimalService.js`:

#### 1. **–£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—Å—Ç—Ä—è–≤—à–∏—Ö –≤—ã–≤–æ–¥–æ–≤:**
```javascript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞—Å—Ç—Ä—è–≤—à–∏–µ –≤—ã–≤–æ–¥—ã –≤ —Å—Ç–∞—Ç—É—Å–µ processing (–±–µ–∑ processingStartedAt)
const stuckWithdrawals = await database.collection('withdrawals').find({
  status: 'processing',
  $or: [
    { processingStartedAt: { $exists: false } },
    { processingStartedAt: { $lt: new Date(Date.now() - 5 * 60 * 1000) } }
  ]
}).toArray();
```

#### 2. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ —Ä–∞–±–æ—á–µ–≥–æ –∫–æ—à–µ–ª—å–∫–∞:**
```javascript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å —Ä–∞–±–æ—á–µ–≥–æ –∫–æ—à–µ–ª—å–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
const workingBalance = await this.getWorkingBalance();
if (workingBalance < amountNum) {
  throw new Error(`Insufficient working wallet balance: ${workingBalance} < ${amountNum}`);
}
```

#### 3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤:**
```javascript
await database.collection('withdrawals').updateOne(
  { _id: withdrawalData._id },
  {
    $set: {
      txHash: txHash,
      status: 'sent',
      processedAt: new Date()
    },
    $unset: { processingStartedAt: 1 } // –£–±–∏—Ä–∞–µ–º –ø–æ–ª–µ processingStartedAt
  }
);
```

#### 4. **–£–≤–µ–ª–∏—á–µ–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```javascript
}, 10000); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ (–±—ã–ª–æ 15000)
```

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- `backend/services/decimalService.js` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω withdrawal worker

### –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:
1. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—Å—Ç—Ä—è–≤—à–∏—Ö –≤—ã–≤–æ–¥–æ–≤** - –≤–∫–ª—é—á–∞—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `processingStartedAt`
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞** - –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
3. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤** - —É–±–∏—Ä–∞–µ–º `processingStartedAt` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
4. **–ë–æ–ª–µ–µ —á–∞—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** - –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ –≤–º–µ—Å—Ç–æ 15

### –£–ª—É—á—à–µ–Ω–∏—è:
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –≤—ã–≤–æ–¥—ã –±–æ–ª—å—à–µ –Ω–µ –∑–∞—Å—Ç—Ä–µ–≤–∞—é—Ç
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤
- ‚úÖ **Fallback –Ω–∞ RPC** - —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã** - —á–µ—Ç–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–≤–æ–¥–æ–≤** - —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞
2. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã** - queued ‚Üí processing ‚Üí sent/failed
3. **TX Hash —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –±–ª–æ–∫—á–µ–π–Ω
4. **–í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤** - –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å API
- **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - —á–µ—Ç–∫–∏–µ —Å—Ç–∞—Ç—É—Å—ã –∏ –ª–æ–≥–∏
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - —Å–ª–µ–¥–∏—Ç—å –∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –≤—ã–≤–æ–¥–æ–≤
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –≤—ã–≤–æ–¥–∞–º–∏
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - —É–±–µ–¥–∏—Ç—å—Å—è –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ—à–∏–±–æ–∫

---
**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 23.07.2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ  
**–§–∞–π–ª**: `backend/services/decimalService.js` 